{"version":3,"sources":["be/scripts.js"],"names":["bloecks","addPlugin","init","_this","this","$","each","i","slicewrapper","sortable","ev","find","length","addSortables","markDisabledItems","disabledClass","j","slice","addClass","appendTo","document","body","handle","placeholder","cancel","containment","items","start","event","ui","css","height","item","outerHeight","width","outerWidth","stop","hasClass","removeClass","update","this_id","getSliceId","prev_id","prevAll","first","console","log","url","window","location","href","replace","indexOf","executePjax"],"mappings":"AAAAA,QAAQC,UACJ,aAEIC,KAAO,WAEH,GAAIC,GAAQC,IAEZC,GAAA,eAAiBC,KAAK,SAASC,EAAGC,GAG9B,IACIH,EAAEG,GAAcC,SAAQ,WAC1B,MAAMC,IAENL,EAAIG,GAAcG,KAAI,6BAA8BC,QAGlDT,EAAMU,aAAaL,MAK/BM,kBAAoB,SAASN,EAAcO,GAEvCA,EAAyC,gBAAnB,GAA8B,oBAAsBA,EAE1EV,EAAEG,GAAcG,KAAI,0BAA6BI,EAAgB,KAAKT,KAAK,SAASU,EAAGC,GAEjFZ,EAAIY,GAAON,KAAI,4BAA6BC,QAG1CP,EAAEY,GAAOC,SAASH,MAK9BF,aAAe,SAASL,GAEpB,GAAIO,GAAgB,mBAEpBX,MAAKU,kBAAkBN,EAAcO,GAErCV,EAAEG,GAAcC,UACZU,SAAUC,SAASC,KACnBC,OAAQ,iBACRC,YAAa,kCACbC,OAAQT,EACRU,YAAapB,EAAEG,GACfkB,MAAO,+BAEPC,MAAQ,SAASC,EAAOC,GAEpBxB,EAAED,MAAMc,SAAQ,oBAEhBW,EAAGN,YAAYO,KACXC,OAASF,EAAGG,KAAKC,cACjBC,MAAQL,EAAGG,KAAKG,aAAe,KAIvCC,KAAO,SAASR,EAAOC,GAEjBxB,EAAID,MAAMiC,SAAQ,qBAEhBhC,EAAED,MAAMkC,YAAW,qBAI3BC,OAAS,SAASX,EAAOC,GAErBxB,EAAED,MAAMc,SAAQ,mBAEhB,IAAIsB,GAAUxC,QAAQyC,WAAWZ,EAAGG,MAChCU,EAAUb,EAAGG,KAAKW,QAAO,+BAAgC/B,OAASZ,QAAQyC,WAAWZ,EAAGG,KAAKW,QAAO,+BAAgCC,SAAW,CAEnJ,IAAe,OAAZJ,GAAgC,OAAZE,EACvB,CACIG,QAAQC,IAAG,kBAAqBN,EAAU,sBAAwBE,EAClE,IAAIK,GAAMC,OAAOC,SAASC,KAAKC,QAAO,eAAM,+BAAyCA,QAAO,iCAAiC,GAC7HJ,KAAOA,EAAIK,QAAO,MAAQ,EAAK,IAAM,KAAO,QAAUZ,EAAU,WAAaE,EAE7E1C,QAAQqD,YAAYN","file":"be.js","sourcesContent":["bloecks.addPlugin(\n    'dragndrop',\n    {\n        init : function()\n        {\n            var _this = this;\n            // for each rex-slices container\n            $('.rex-slices').each(function(i, slicewrapper)\n            {\n                // remove any sortable\n                try {\n                    $(slicewrapper).sortable('destroy');\n                } catch(ev) { }\n\n                if(!$(slicewrapper).find('.rex-slice.rex-slice-edit').length)\n                {\n                    // only add sortables if the page is not in EDIT mode\n                    _this.addSortables(slicewrapper);\n                }\n            });\n        },\n\n        markDisabledItems : function(slicewrapper, disabledClass)\n        {\n            disabledClass = typeof(disabledClass) != 'string' ? 'ui-state-disabled' : disabledClass;\n\n            $(slicewrapper).find('.rex-slice-output:not(.' + disabledClass + ')').each(function(j, slice)\n            {\n                if(!$(slice).find('[href*=\"direction=move\"]').length)\n                {\n                    // we won't let the user move items that cannot be moved by perms etc.\n                    $(slice).addClass(disabledClass);\n                }\n            });\n        },\n\n        addSortables : function(slicewrapper)\n        {\n            var disabledClass = 'ui-state-disabled';\n\n            this.markDisabledItems(slicewrapper, disabledClass);\n\n            $(slicewrapper).sortable({\n                appendTo: document.body,\n                handle: '.panel-heading',\n                placeholder: 'rex-slice rex-slice-placeholder',\n                cancel: disabledClass,\n                containment: $(slicewrapper),\n                items: '>.rex-slice.rex-slice-output',\n\n                start : function(event, ui)\n                {\n                    $(this).addClass('ui-state-sorting');\n\n                    ui.placeholder.css({\n                        height : ui.item.outerHeight(),\n                        width : ui.item.outerWidth() - 1\n                    });\n                },\n\n                stop : function(event, ui)\n                {\n                    if(!$(this).hasClass('ui-state-updated'))\n                    {\n                        $(this).removeClass('ui-state-sorting');\n                    }\n                },\n\n                update : function(event, ui)\n                {\n                    $(this).addClass('ui-state-updated');\n\n                    var this_id = bloecks.getSliceId(ui.item),\n                        prev_id = ui.item.prevAll('.rex-slice.rex-slice-output').length ? bloecks.getSliceId(ui.item.prevAll('.rex-slice.rex-slice-output').first()) : 0;\n\n                    if(this_id !== null && prev_id !== null)\n                    {\n                        console.log('Update prio of ' + this_id + ' and move it after ' + prev_id);\n                        var url = window.location.href.replace(/page=([^&]+)/,'page=bloecks/dragndrop/move').replace(/(&|\\?)move[(\\d+)][prev]=(\\d+)/g,'');\n                        url+= (url.indexOf('?') > -1 ? '&' : '?') + 'move[' + this_id + '][prev]=' + prev_id;\n\n                        bloecks.executePjax(url);\n                    }\n                }\n            });\n        },\n    }\n);\n"]}