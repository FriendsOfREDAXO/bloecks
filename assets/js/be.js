var bloecks_code={init:function(){},insertLinebreakAtCursor:function(e){var t,n=e.value;if(void 0!==e.selectionStart&&void 0!==e.selectionEnd){if(before=n.slice(0,e.selectionStart),matches=before.match(/(\n|^)(\t+|\s+)?[^\n]+$/),console.log(matches),matches&&void 0!==matches[2])return this.insertTextAtCursor(e,"\n"+matches[2]),!1}else void 0!==document.selection&&void 0!==document.selection.createRange&&(e.focus(),(t=document.selection.createRange()).collapse(!1),console.log("RANGE"),console.log(t),t.select());return!0},jumpToPreviousTab:function(e){var t,n=e.value;void 0!==e.selectionStart&&void 0!==e.selectionEnd?(before=n.slice(0,e.selectionStart),matches=before.match(/(\n|^)(.*)[^\n]+$/),console.log(matches)):void 0!==document.selection&&void 0!==document.selection.createRange&&(e.focus(),(t=document.selection.createRange()).collapse(!1),console.log("RANGE"),console.log(t),t.select())},insertTextAtCursor:function(e,t){var n,i,o=e.value;void 0!==e.selectionStart&&void 0!==e.selectionEnd?(n=e.selectionEnd,e.value=o.slice(0,e.selectionStart)+t+o.slice(n),e.selectionStart=e.selectionEnd=n+t.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(e.focus(),(i=document.selection.createRange()).collapse(!1),i.text=t,i.select())}};$(document).on("ready.bloecks",$.proxy(bloecks_code.init,bloecks_code)),bloecks.addPlugin("dragndrop",{init:function(){var e=this;$(".rex-slices:not(.is--undraggable)").each(function(t,n){try{$(n).sortable("destroy")}catch(e){}$(n).find(".rex-slice.rex-slice-edit, .rex-slice.rex-slice-add").length?$(n).addClass("is--editing"):e.addSortables(n)})},markDisabledItems:function(e,t){t="string"!=typeof t?"ui-state-disabled":t,$(e).find(".rex-slice-output:not(."+t+")").each(function(e,n){$(n).find('[href*="direction=move"]').length||$(n).addClass(t)})},addSortables:function(e){var t="ui-state-disabled";this.markDisabledItems(e,t),$(e).sortable({appendTo:document.body,handle:".rex-page-section>.panel>.panel-heading",placeholder:"rex-slice rex-slice-placeholder",cancel:t,helper:"clone",items:">.rex-slice.rex-slice-draggable",create:function(t,n){$(e).css({minHeight:$(e).outerHeight()})},start:function(e,t){$(this).addClass("ui-state-sorting"),$(this).sortable("refreshPositions"),t.placeholder.height(t.helper.outerHeight())},stop:function(e,t){$(this).hasClass("ui-state-updated")||$(this).removeClass("ui-state-sorting")},update:function(e,t){$(this).addClass("ui-state-updated"),$(this).sortable("refresh");var n=t.position.top<t.originalPosition.top?"up":"down",i=bloecks.getSliceId(t.item),o=t.item.prevAll(".rex-slice-draggable").length?bloecks.getSliceId(t.item.prevAll(".rex-slice-draggable").first()):0;if(null!==i&&null!==o){console.log("Move "+i+" "+n+", after "+o);var s=t.item.find('[href*="direction=move'+n+'"]').length?t.item.find('[href*="direction=move'+n+'"]').first().attr("href"):null;null!==s?(s=(s=(s=s.replace(/(&amp;|&)direction=move(up|down)/,"$1direction=move$2$1insertafter="+o)).replace(/content_move_slice/,"content_move_slice_to")).replace(/_csrf_token=[^&]+/,"_csrf_token="+t.item.data("csrf-token")),s+="#slice"+i):s=window.location.href,console.log(s),bloecks.executePjax(s)}}})}});var bloecks_fragments={init:function(){console.log("fragments"),this.addToggleButtons()},addToggleButtons:function(){$(document).on({"change.bloecks":function(e){bloecks_fragments.toggle(this)}},'.bloecks--setting input[type="checkbox"][name*="[active]"]')},toggle:function(e){var t=$(e).is(":checked"),n=$(e).attr("id");t?$("."+n).removeClass("is--hidden"):$("."+n).addClass("is--hidden")}};$(document).on("ready.bloecks",$.proxy(bloecks_fragments.init,bloecks_fragments)),$(document).on("rex:ready",function(e){$('.bloecks--setting input[type="checkbox"][name*="[active]"]').each(function(e,t){bloecks_fragments.toggle(t)})});var bloecks={plugins:[],init:function(){for(var e=this.getPlugins(!0),t=e.length,n=0;n<t;n++)this[e[n]].init()},getSliceId:function(e){var t=null;return $(e).is(".rex-slice-output")||(e=$(e).parents(".rex-slice-output").length?$(e).parents(".rex-slice-output").first():1==$(e).find(".rex-slice-output").length?$(e).find(".rex-slice-output").first():null),e&&($(e).find('[href*="slice_id="]').length?t=parseInt($(e).find('[href*="slice_id="]').first().attr("href").replace(/.*slice_id=(\d+).*/,"$1")):$(e).attr("id")&&(t=parseInt($(e).attr("id").replace(/[^0-9]/g,"")))),t},executePjax:function(e){var t=e.match(/(#[^\?\&]+)/);t&&(e=e.replace(/(#[^\?\&]+)/,"")+t[0]),console.log("PJAXing "+e),$.pjax({url:e,container:"#rex-js-page-main-content",fragment:"#rex-js-page-main-content",push:!1})},getPlugins:function(e){return e=!0===e,this.plugins.filter(function(t){return"string"==typeof t&&void 0!==bloecks[t]&&(!e||"function"==typeof bloecks[t].init)})},addPlugin:function(e,t,n){this[e]=t,n=parseInt(n),(n=Math.max(isNaN(n)?0:n,this.plugins.length))>this.plugins.length&&(this.plugins=this.plugins.concat(Array.apply(null,Array(n-this.plugins.length)))),this.plugins.splice(n,0,e)}};$(document).on("rex:ready",$.proxy(bloecks.init,bloecks));